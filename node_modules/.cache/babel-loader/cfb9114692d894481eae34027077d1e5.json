{"ast":null,"code":"import { Vector3, Vector2, Triangle, DoubleSide, BackSide } from 'three'; // Ripped and modified From THREE.js Mesh raycast\n// https://github.com/mrdoob/three.js/blob/0aa87c999fe61e216c1133fba7a95772b503eddf/src/objects/Mesh.js#L115\n\nconst vA = /* @__PURE__ */new Vector3();\nconst vB = /* @__PURE__ */new Vector3();\nconst vC = /* @__PURE__ */new Vector3();\nconst uvA = /* @__PURE__ */new Vector2();\nconst uvB = /* @__PURE__ */new Vector2();\nconst uvC = /* @__PURE__ */new Vector2();\nconst intersectionPoint = /* @__PURE__ */new Vector3();\n\nfunction checkIntersection(ray, pA, pB, pC, point, side) {\n  let intersect;\n\n  if (side === BackSide) {\n    intersect = ray.intersectTriangle(pC, pB, pA, true, point);\n  } else {\n    intersect = ray.intersectTriangle(pA, pB, pC, side !== DoubleSide, point);\n  }\n\n  if (intersect === null) return null;\n  const distance = ray.origin.distanceTo(point);\n  return {\n    distance: distance,\n    point: point.clone()\n  };\n}\n\nfunction checkBufferGeometryIntersection(ray, position, uv, a, b, c, side) {\n  vA.fromBufferAttribute(position, a);\n  vB.fromBufferAttribute(position, b);\n  vC.fromBufferAttribute(position, c);\n  const intersection = checkIntersection(ray, vA, vB, vC, intersectionPoint, side);\n\n  if (intersection) {\n    if (uv) {\n      uvA.fromBufferAttribute(uv, a);\n      uvB.fromBufferAttribute(uv, b);\n      uvC.fromBufferAttribute(uv, c);\n      intersection.uv = Triangle.getUV(intersectionPoint, vA, vB, vC, uvA, uvB, uvC, new Vector2());\n    }\n\n    const face = {\n      a: a,\n      b: b,\n      c: c,\n      normal: new Vector3(),\n      materialIndex: 0\n    };\n    Triangle.getNormal(vA, vB, vC, face.normal);\n    intersection.face = face;\n    intersection.faceIndex = a;\n  }\n\n  return intersection;\n} // https://github.com/mrdoob/three.js/blob/0aa87c999fe61e216c1133fba7a95772b503eddf/src/objects/Mesh.js#L258\n\n\nfunction intersectTri(geo, side, ray, tri, intersections) {\n  const triOffset = tri * 3;\n  const a = geo.index.getX(triOffset);\n  const b = geo.index.getX(triOffset + 1);\n  const c = geo.index.getX(triOffset + 2);\n  const intersection = checkBufferGeometryIntersection(ray, geo.attributes.position, geo.attributes.uv, a, b, c, side);\n\n  if (intersection) {\n    intersection.faceIndex = tri;\n    if (intersections) intersections.push(intersection);\n    return intersection;\n  }\n\n  return null;\n}\n\nexport { intersectTri };","map":null,"metadata":{},"sourceType":"module"}